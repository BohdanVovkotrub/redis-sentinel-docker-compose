FROM redis:7-alpine

ARG REDIS_MASTER_HOST
ARG REDIS_MASTER_PORT
ARG REDIS_SENTINEL_PORT
ARG REDIS_SENTINEL_QUORUM
ARG REDIS_SENTINEL_DOWN_AFTER
ARG REDIS_SENTINEL_FAILOVER
ARG REDIS_SENTINEL_NAME
ARG REDIS_PASSWORD

ENV MASTER_HOST=${REDIS_MASTER_HOST}
ENV MASTER_PORT=${REDIS_MASTER_PORT}
ENV PASSWORD=${REDIS_PASSWORD}
ENV SENTINEL_NAME=${REDIS_SENTINEL_NAME}
ENV SENTINEL_PORT=${REDIS_SENTINEL_PORT}
ENV SENTINEL_QUORUM=${REDIS_SENTINEL_QUORUM}
ENV SENTINEL_DOWN_AFTER=${REDIS_SENTINEL_DOWN_AFTER}
ENV SENTINEL_FAILOVER=${REDIS_SENTINEL_FAILOVER}

RUN mkdir -p /redis
 
WORKDIR /redis
 
COPY sentinel.conf .
COPY sentinel-entrypoint.sh /usr/local/bin/
 
RUN chown redis:redis /redis/* && \
    chmod +x /usr/local/bin/sentinel-entrypoint.sh
 
EXPOSE ${REDIS_SENTINEL_PORT}


ENTRYPOINT ["sentinel-entrypoint.sh"]